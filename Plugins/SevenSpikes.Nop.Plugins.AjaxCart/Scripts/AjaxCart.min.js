/*
* Copyright 2014 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

$(document).ready(function () { (function (e, t, n) { function i() { var e = f(); var n = e.buttonsParameters; if (n.length > 0) { var r = j(); t.ajax({ cache: false, type: "POST", data: t.toJSON(n), contentType: "application/json; charset=utf-8", url: r, success: function (t) { if (t != "") { for (var n = 0; n < e.addToCartButtons.length; n++) { B(t, e.addToCartButtons[n]) } } }, error: function (e, t, n) { return } }) } } function s(n) { if (e.waitForAjaxRequest) { return } e.waitForAjaxRequest = true; var r = P(); var i = H(); var s = t.getAttrValFromDom(n.currentTarget, "data-productId"); var o = D(n.currentTarget); var u = { productId: s, quantity: o }; F(); var a = false; var f = false; t.ajax({ cache: false, async: false, type: "POST", dataType: "json", data: t.toJSON(u), contentType: "application/json; charset=utf-8", url: i, success: function (e) { a = e.HasProductAttributes }, error: function (e, t, n) { f = true } }); if (f) { I(); e.waitForAjaxRequest = false; return } if (a) { A(s, o); I(); e.waitForAjaxRequest = false; return } t.ajax({ cache: false, type: "POST", dataType: "json", data: t.toJSON(u), contentType: "application/json; charset=utf-8", url: r, success: function (n) { I(); e.waitForAjaxRequest = false; if (n.Status == "success") { L(); k(); C(); N(o); T(n.ProductAddedToCartWindow); t.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) } else if (n.Status == "warning") { x(n.AddToCartWarnings) } else if (n.Status == "error") { x(n.ErrorMessage) } }, error: function (t, n, r) { I(); e.waitForAjaxRequest = false } }) } function o(r, i) { if (i == n) { i = false } if (e.waitForAjaxRequest) { return } e.waitForAjaxRequest = true; var s = t(r.currentTarget); var o = S(); var u = t.getAttrValFromDom(r.currentTarget, "data-productId"); var a = "productId"; var f = E(s); var l = t(s).closest("form").serialize(); if (l.length == 0) { var c = q(); formSelector = t(c).find("form"); l = t(formSelector).serialize() } if (l.length != 0) { l += "&" } l += a + "=" + u; b(i); t.ajax({ cache: false, type: "POST", data: l, url: o, success: function (n) { if (n.Status == "warning" || n.Status == "error") { g(i); e.waitForAjaxRequest = false; m(n.AddToCartWarnings, n.PopupTitle, i) } else { L(); C(); N(f); k(); if (i) { v() } g(i); e.waitForAjaxRequest = false; T(n.ProductAddedToCartWindow); t.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) } }, error: function (t, n, r) { g(i); e.waitForAjaxRequest = false } }) } function u() { var e = q(); var n = t(e); if (n.find(".nopAjaxCartPanelAjaxBusy").length == 0) { n.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'); t(".nopAjaxCartPanelAjaxBusy").hide() } if (n.find(".nopAjaxCartPanelAjaxBusy").length == 0) { n.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'); t(".nopAjaxCartPanelAjaxBusy").hide() } } function a() { var e = q(); var n = t(e); if (n.length > 0) { n.prepend('<div class="productAddedToCartWindow"></div>'); n.prepend('<div class="miniProductDetailsView"></div>'); n.prepend('<div class="addProductVariantToCartErrors"></div>'); n.prepend('<div class="addProductToCartErrors"></div>'); var r = t(".miniProductDetailsView").kendoWindow({ draggable: false, resizable: false, modal: true, actions: ["Close"], animation: false, visible: false }).data("kendoWindow"); r.wrapper.addClass("ajaxCart") } var i = t(".productAddedToCartWindow").kendoWindow({ draggable: false, resizable: false, modal: true, actions: ["Close"], animation: false, visible: false }).data("kendoWindow"); i.wrapper.addClass("ajaxCart") } function f() { var e = d(); var n = p(); var r = []; var i = []; t(e).each(function () { if (!t(this).is(".nopAjaxCartProductVariantAddToCartButton")) { var e = t.getAttrValFromDom(this, "data-productid", 0); if (e && e > 0) { var n = { productId: e, isProductPage: true, buttonElement: t(this) }; var s = { productId: e, isProductPage: true, buttonValue: h(t(this)) }; r.push(n); i.push(s) } } }); t(n).each(function () { if (!t(this).is(".nopAjaxCartProductListAddToCartButton")) { var e = l(t(this)); if (e && e > 0) { var n = { productId: e, isProductPage: false, buttonElement: t(this) }; var s = { productId: e, isProductPage: false, buttonValue: h(t(this)) }; r.push(n); i.push(s) } } }); return { addToCartButtons: r, buttonsParameters: i } } function l(e) { var r = c(); if (r == n || r == "") { return 0 } return t.getAttrValFromDom(t(e).parents(r), "data-productid", 0) } function c() { return t.getAttrValFromDom(r, "data-productBoxProductItemElementSelector") } function h(e) { return t.getAttrValFromDom(e, "value") } function p() { return t.getAttrValFromDom(r, "data-productBoxAddToCartButtonSelector") } function d() { return t.getAttrValFromDom(r, "data-productPageAddToCartButtonSelector") } function v() { var e = t(".miniProductDetailsView").data("kendoWindow"); e.close() } function m(e, n, r) { if (!r) { var i = t(".addProductVariantToCartErrors").data("kendoWindow"); if (!i) { i = t(".addProductVariantToCartErrors").kendoWindow({ draggable: false, resizable: false, width: "300px", height: "100px", modal: true, actions: ["Close"], animation: false, visible: false, title: n }).data("kendoWindow"); i.wrapper.addClass("ajaxCart") } i.content(e); i.center(); i.open() } else { t(".miniProductDetailsView .message-error").html(e) } } function g(e) { if (!e) { I() } else { y() } } function y() { t(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() } function b(e) { if (!e) { F() } else { w() } } function w() { if (t(".miniProductDetailsView").length > 0) { var e = t(".miniProductDetailsView").parent().height(); var n = t(".miniProductDetailsView").parent().width(); t(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(e - 10); t(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(n - 10); t(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } } function E(e) { var n = 1; var r = t.getAttrValFromDom(e, "data-productId"); if (r != "") { var i = "#addtocart_" + r + "_EnteredQuantity"; if (t(i).length > 0) { var s = t(i).val(); if (s > 0) { n = s } } } return n } function S() { var e = t.getHiddenValFromDom("#addProductVariantToCartUrl"); return e } function x(e) { var n = t(".addProductToCartErrors").data("kendoWindow"); if (!n) { n = t(".addProductToCartErrors").kendoWindow({ draggable: false, resizable: false, width: "300px", height: "100px", modal: true, actions: ["Close"], animation: false, visible: false }).data("kendoWindow"); n.wrapper.addClass("ajaxCart") } n.content(e); n.center(); n.open() } function T(e) { t(".productAddedToCartWindow").html(t(e).html()); var n = t(".productAddedToCartWindow").data("kendoWindow"); n.center(); n.open() } function N(e) { var n = '.header-links a[href="/cart"]'; var r = t.getHiddenValFromDom("#shoppingCartMenuLinkSelector"); if (t("#shoppingCartMenuLinkSelector").length > 0 && r != "") { n = r; n = t("<div/>").html(n).text() } var i = t(n).filter(":last"); if (i.length > 0) { var s = /\d+/; var o = i.html(); var u = s.exec(o); var a = parseInt(u); e = a + parseInt(e); var f = "(" + e + ")"; i.html(f) } } function C() { var e = t.getHiddenValFromDom("#shoppingCartBoxUrl"); var n = t.getHiddenValFromDom("#shoppingCartBoxPanelSelector"); if (t(n).length > 0) { t.ajax({ cache: false, type: "GET", url: e, success: function (e) { var r = t(e).filter(n); t(n).replaceWith(r) }, error: function (e, t, n) { } }) } } function k() { var e = t.getHiddenValFromDom("#flyoutShoppingCartUrl"); var n = t.getHiddenValFromDom("#flyoutShoppingCartPanelSelector"); if (t(n).length > 0) { t.ajax({ cache: false, type: "GET", url: e, success: function (e) { var r = t(e).filter(n); t(n).replaceWith(r) }, error: function (e, t, n) { } }) } } function L() { var e = t.getHiddenValFromDom("#miniShoppingCartUrl"); var n = ".block.block-shoppingcart"; if (t(n).length > 0) { t.ajax({ cache: false, type: "GET", url: e, success: function (e) { var r = t(e).filter(n); t(n).replaceWith(r) }, error: function (e, t, n) { } }) } } function A(e, n) { var r = { productId: e }; var i = _(); t.ajax({ cache: false, async: false, type: "POST", data: t.toJSON(r), contentType: "application/json; charset=utf-8", url: i, success: function (e) { O(e); M(n) }, error: function (e, t, n) { } }) } function O(e) { e = '<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + e; var n = t(".miniProductDetailsView").data("kendoWindow").content(e); n.center(); n.open() } function M(e) { var n = t.getAttrValFromDom(".miniProductDetailsView .miniProductDetailsViewAddToCartButton", "data-productId", 0); if (n > 0) { var r = ".miniProductDetailsView #addtocart_" + n + "_EnteredQuantity"; if (t(r).length > 0) { t(r).val(e) } } } function _() { return t.getHiddenValFromDom("#getMiniProductDetailsViewUrl") } function D(e) { var n = 1; var r = t.getAttrValFromDom(e, "data-productId"); if (r != "") { var i = "#productQuantity" + r; if (t(i).length > 0) { var s = t(i).val(); if (s > 0) { n = s } } } return n } function P() { return t.getHiddenValFromDom("#addProductToCartUrl") } function H() { return t.getHiddenValFromDom("#checkProductAttributesUrl") } function B(e, n) { var r = t(e).filter("div[data-productId='" + n.productId + "']"); if (r && r.length > 0) { var i = t.getAttrValFromDom(r, "data-isProductPage"); if (i && i == n.isProductPage.toString()) { t(n.buttonElement).replaceWith(r[0]) } } } function j() { return t.getAttrValFromDom(r, "data-getAjaxCartButtonUrl") } function F() { var e = q(); var n = t(e); if (n.length > 0) { var r = n.height(); var i = n.width(); t(".nopAjaxCartPanelAjaxBusy").height(r); t(".nopAjaxCartPanelAjaxBusy").width(i); t(".nopAjaxCartPanelAjaxBusy").show() } } function I() { t(".nopAjaxCartPanelAjaxBusy").hide() } function q() { var e = "body"; return e } e.waitForAjaxRequest = false; var r = ".ajaxCartInfo"; e.closeProductAddedToCartWindow = function () { var e = t(".productAddedToCartWindow").data("kendoWindow"); if (e) { e.close() } }; var R = t.getSpikesViewPort(); if (!t.isMobile() && R.width > 980) { i(); u(); a(); t("body").on("click", ".nopAjaxCartProductListAddToCartButton", function (e) { s(e) }); t("body").on("click", ".nopAjaxCartProductVariantAddToCartButton", function (e) { var n = false; if (t(this).hasClass("miniProductDetailsViewAddToCartButton")) { n = true } o(e, n) }); t(document).on("nopAjaxFiltersFiltrationCompleteEvent", i); t(document).on("nopQuickViewDataShownEvent", i) } })(window.nopAjaxCart = window.nopAjaxCart || {}, jQuery) })